// Sistema de traduções ampliado para D&D 5e
export const translations = {
  races: {
    'human': 'Humano',
    'elf': 'Elfo',
    'dwarf': 'Anão',
    'halfling': 'Halfling',
    'half-elf': 'Meio-Elfo',
    'half-orc': 'Meio-Orc',
    'gnome': 'Gnomo',
    'tiefling': 'Tiefling',
    'dragonborn': 'Draconato',
    'drow': 'Drow',
    'high-elf': 'Alto Elfo',
    'wood-elf': 'Elfo da Floresta',
    'hill-dwarf': 'Anão da Colina',
    'mountain-dwarf': 'Anão da Montanha',
    'lightfoot': 'Pés Ligeiros',
    'stout': 'Halfling Robusto',
    'rock-gnome': 'Gnomo da Rocha',
    'forest-gnome': 'Gnomo da Floresta',
    'alseid': 'Alseid',
    'catfolk': 'Povo Gato',
    'darakhul': 'Darakhul',
    'derro': 'Derro',
    'erina': 'Erina',
    'gearforged': 'Forjado em Engrenagens',
    'minotaur': 'Minotauro',
    'mushroomfolk': 'Povo Cogumelo',
    'satarre': 'Satarre',
    'shade': 'Sombra',
    'aarakocra': 'Aarakocra',
    'aasimar': 'Aasimar',
    'firbolg': 'Firbolg',
    'genasi': 'Genasi',
    'goliath': 'Golias',
    'kenku': 'Kenku',
    'lizardfolk': 'Homem-Lagarto',
    'tabaxi': 'Tabaxi',
    'triton': 'Tritão',
    'yuan-ti': 'Yuan-ti'
  },
  
  classes: {
    'barbarian': 'Bárbaro',
    'bard': 'Bardo',
    'cleric': 'Clérigo',
    'druid': 'Druida',
    'fighter': 'Guerreiro',
    'monk': 'Monge',
    'paladin': 'Paladino',
    'ranger': 'Batedor',
    'rogue': 'Ladino',
    'sorcerer': 'Feiticeiro',
    'warlock': 'Bruxo',
    'wizard': 'Mago',
    'artificer': 'Artífice'
  },
  
  abilities: {
    'Strength': 'Força',
    'Dexterity': 'Destreza', 
    'Constitution': 'Constituição',
    'Intelligence': 'Inteligência',
    'Wisdom': 'Sabedoria',
    'Charisma': 'Carisma'
  },

  skills: {
    'Acrobatics': 'Acrobacia',
    'Animal Handling': 'Lidar com Animais',
    'Arcana': 'Arcanismo',
    'Athletics': 'Atletismo',
    'Deception': 'Blefe',
    'History': 'História',
    'Insight': 'Intuição',
    'Intimidation': 'Intimidação',
    'Investigation': 'Investigação',
    'Medicine': 'Medicina',
    'Nature': 'Natureza',
    'Perception': 'Percepção',
    'Performance': 'Atuação',
    'Persuasion': 'Persuasão',
    'Religion': 'Religião',
    'Sleight of Hand': 'Prestidigitação',
    'Stealth': 'Furtividade',
    'Survival': 'Sobrevivência'
  },

  spellSchools: {
    'abjuration': 'Abjuração',
    'conjuration': 'Conjuração',
    'divination': 'Adivinhação',
    'enchantment': 'Encantamento',
    'evocation': 'Evocação',
    'illusion': 'Ilusão',
    'necromancy': 'Necromancia',
    'transmutation': 'Transmutação'
  },

  backgrounds: {
    'Acolyte': 'Acólito',
    'Criminal': 'Criminoso',
    'Folk Hero': 'Herói Popular',
    'Noble': 'Nobre',
    'Sage': 'Erudito',
    'Soldier': 'Soldado',
    'Charlatan': 'Charlatão',
    'Entertainer': 'Artista',
    'Guild Artisan': 'Artesão de Guilda',
    'Hermit': 'Eremita',
    'Outlander': 'Forasteiro',
    'Sailor': 'Marinheiro'
  },

  alignments: {
    'Lawful Good': 'Leal e Bom',
    'Neutral Good': 'Neutro e Bom',
    'Chaotic Good': 'Caótico e Bom',
    'Lawful Neutral': 'Leal e Neutro',
    'True Neutral': 'Neutro',
    'Chaotic Neutral': 'Caótico e Neutro',
    'Lawful Evil': 'Leal e Mau',
    'Neutral Evil': 'Neutro e Mau',
    'Chaotic Evil': 'Caótico e Mau'
  },
  
  terms: {
    'Hit Points': 'Pontos de Vida',
    'Armor Class': 'Classe de Armadura',
    'Speed': 'Velocidade',
    'Darkvision': 'Visão no Escuro',
    'Languages': 'Idiomas',
    'Proficiencies': 'Proficiências',
    'Traits': 'Traços',
    'Features': 'Características',
    'Equipment': 'Equipamentos',
    'Weapons': 'Armas',
    'Armor': 'Armaduras',
    'Tools': 'Ferramentas',
    'Saving Throws': 'Testes de Resistência',
    'Skills': 'Perícias',
    'feet': 'metros',
    'Cantrips': 'Truques',
    'Spell Slots': 'Espaços de Magia',
    'Initiative': 'Iniciativa',
    'Proficiency Bonus': 'Bônus de Proficiência',
    'Experience Points': 'Pontos de Experiência'
  },
  
  equipment: {
    'Leather Armor': 'Armadura de Couro',
    'Chain Mail': 'Cota de Malha',
    'Scale Mail': 'Brunea',
    'Chain Shirt': 'Camisa de Malha',
    'Studded Leather': 'Couro Batido',
    'Hide Armor': 'Armadura de Couro Cru',
    'Padded': 'Acolchoada',
    'Ring Mail': 'Cota de Anéis',
    'Splint': 'Couraceada',
    'Plate': 'Placas',
    'Shield': 'Escudo',
    'Sword': 'Espada',
    'Longsword': 'Espada Longa',
    'Shortsword': 'Espada Curta',
    'Greatsword': 'Montante',
    'Scimitar': 'Cimitarra',
    'Rapier': 'Rapieira',
    'Bow': 'Arco',
    'Longbow': 'Arco Longo',
    'Shortbow': 'Arco Curto',
    'Crossbow': 'Besta',
    'Dagger': 'Adaga',
    'Staff': 'Cajado',
    'Quarterstaff': 'Bordão',
    'Mace': 'Maça',
    'Warhammer': 'Martelo de Guerra',
    'Battleaxe': 'Machado de Batalha',
    'Handaxe': 'Machado de Mão',
    'Javelin': 'Azagaia',
    'Spear': 'Lança',
    'Trident': 'Tridente',
    'Club': 'Clava',
    'Sling': 'Funda',
    'Dart': 'Dardo',
    'Backpack': 'Mochila',
    'Rope': 'Corda',
    'Rations': 'Rações',
    'Bedroll': 'Saco de Dormir',
    'Thieves Tools': 'Ferramentas de Ladrão',
    'Holy Symbol': 'Símbolo Sagrado',
    'Spellbook': 'Livro de Magias',
    'Component Pouch': 'Bolsa de Componentes',
    'Arcane Focus': 'Foco Arcano',
    'Druidcraft Focus': 'Foco Druídico',
    'Explorer\'s Pack': 'Kit do Explorador',
    'Dungeoneer\'s Pack': 'Kit do Aventureiro',
    'Entertainer\'s Pack': 'Kit do Artista',
    'Scholar\'s Pack': 'Kit do Erudito',
    'Priest\'s Pack': 'Kit do Sacerdote',
    'Burglar\'s Pack': 'Kit do Ladino'
  },

  damageTypes: {
    'acid': 'ácido',
    'bludgeoning': 'concussão',
    'cold': 'frio',
    'fire': 'fogo',
    'force': 'energia',
    'lightning': 'elétrico',
    'necrotic': 'necrótico',
    'piercing': 'perfurante',
    'poison': 'veneno',
    'psychic': 'psíquico',
    'radiant': 'radiante',
    'slashing': 'cortante',
    'thunder': 'trovão'
  },

  conditions: {
    'blinded': 'cego',
    'charmed': 'enfeitiçado',
    'deafened': 'surdo',
    'exhaustion': 'exaustão',
    'frightened': 'amedrontado',
    'grappled': 'agarrado',
    'incapacitated': 'incapacitado',
    'invisible': 'invisível',
    'paralyzed': 'paralisado',
    'petrified': 'petrificado',
    'poisoned': 'envenenado',
    'prone': 'caído',
    'restrained': 'impedido',
    'stunned': 'atordoado',
    'unconscious': 'inconsciente'
  }
};

// Dados de progressão de classe
export const classProgression = {
  barbarian: {
    hitDie: 12,
    primaryAbility: 'Força',
    savingThrows: ['Força', 'Constituição'],
    spellcaster: false,
    features: {
      1: ['Rage', 'Unarmored Defense'],
      2: ['Reckless Attack', 'Danger Sense'],
      3: ['Primal Path'],
      4: ['Ability Score Improvement'],
      5: ['Extra Attack', 'Fast Movement']
    }
  },
  
  bard: {
    hitDie: 8,
    primaryAbility: 'Carisma',
    savingThrows: ['Destreza', 'Carisma'],
    spellcaster: true,
    spellcastingAbility: 'Carisma',
    spellSlots: {
      1: [2, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
      2: [0, 0, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
      3: [0, 0, 0, 0, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
      4: [0, 0, 0, 0, 0, 0, 1, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
      5: [0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3]
    },
    features: {
      1: ['Bardic Inspiration', 'Spellcasting'],
      2: ['Jack of All Trades', 'Song of Rest'],
      3: ['Bard College', 'Expertise'],
      4: ['Ability Score Improvement'],
      5: ['Font of Inspiration']
    }
  },

  cleric: {
    hitDie: 8,
    primaryAbility: 'Sabedoria',
    savingThrows: ['Sabedoria', 'Carisma'],
    spellcaster: true,
    spellcastingAbility: 'Sabedoria',
    spellSlots: {
      1: [2, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
      2: [0, 0, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
      3: [0, 0, 0, 0, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
      4: [0, 0, 0, 0, 0, 0, 1, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
      5: [0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3]
    },
    features: {
      1: ['Spellcasting', 'Divine Domain'],
      2: ['Channel Divinity', 'Divine Domain Feature'],
      3: [],
      4: ['Ability Score Improvement'],
      5: ['Destroy Undead']
    }
  },

  fighter: {
    hitDie: 10,
    primaryAbility: 'Força ou Destreza',
    savingThrows: ['Força', 'Constituição'],
    spellcaster: false,
    features: {
      1: ['Fighting Style', 'Second Wind'],
      2: ['Action Surge'],
      3: ['Martial Archetype'],
      4: ['Ability Score Improvement'],
      5: ['Extra Attack']
    }
  },

  rogue: {
    hitDie: 8,
    primaryAbility: 'Destreza',
    savingThrows: ['Destreza', 'Inteligência'],
    spellcaster: false,
    features: {
      1: ['Expertise', 'Sneak Attack', 'Thieves\' Cant'],
      2: ['Cunning Action'],
      3: ['Roguish Archetype'],
      4: ['Ability Score Improvement'],
      5: ['Uncanny Dodge']
    }
  },

  wizard: {
    hitDie: 6,
    primaryAbility: 'Inteligência',
    savingThrows: ['Inteligência', 'Sabedoria'],
    spellcaster: true,
    spellcastingAbility: 'Inteligência',
    spellSlots: {
      1: [2, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
      2: [0, 0, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
      3: [0, 0, 0, 0, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
      4: [0, 0, 0, 0, 0, 0, 1, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
      5: [0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3]
    },
    features: {
      1: ['Spellcasting', 'Arcane Recovery'],
      2: ['Arcane Tradition'],
      3: [],
      4: ['Ability Score Improvement'],
      5: []
    }
  }
};

// Bônus raciais
export const racialBonuses = {
  human: {
    abilityScoreIncrease: { all: 1 },
    size: 'Medium',
    speed: 30,
    languages: ['Common', 'choice'],
    traits: ['Extra Language', 'Extra Skill']
  },
  
  elf: {
    abilityScoreIncrease: { 'Destreza': 2 },
    size: 'Medium',
    speed: 30,
    darkvision: 60,
    languages: ['Common', 'Elvish'],
    traits: ['Fey Ancestry', 'Keen Senses', 'Trance']
  },
  
  dwarf: {
    abilityScoreIncrease: { 'Constituição': 2 },
    size: 'Medium',
    speed: 25,
    darkvision: 60,
    languages: ['Common', 'Dwarvish'],
    traits: ['Dwarven Resilience', 'Stonecunning', 'Dwarven Combat Training']
  },
  
  halfling: {
    abilityScoreIncrease: { 'Destreza': 2 },
    size: 'Small',
    speed: 25,
    languages: ['Common', 'Halfling'],
    traits: ['Lucky', 'Brave', 'Halfling Nimbleness']
  },
  
  dragonborn: {
    abilityScoreIncrease: { 'Força': 2, 'Carisma': 1 },
    size: 'Medium',
    speed: 30,
    languages: ['Common', 'Draconic'],
    traits: ['Draconic Ancestry', 'Breath Weapon', 'Damage Resistance']
  },
  
  gnome: {
    abilityScoreIncrease: { 'Inteligência': 2 },
    size: 'Small',
    speed: 25,
    darkvision: 60,
    languages: ['Common', 'Gnomish'],
    traits: ['Gnome Cunning']
  },
  
  'half-elf': {
    abilityScoreIncrease: { 'Carisma': 2, choice: 2 },
    size: 'Medium',
    speed: 30,
    darkvision: 60,
    languages: ['Common', 'Elvish', 'choice'],
    traits: ['Fey Ancestry', 'Extra Skills']
  },
  
  'half-orc': {
    abilityScoreIncrease: { 'Força': 2, 'Constituição': 1 },
    size: 'Medium',
    speed: 30,
    darkvision: 60,
    languages: ['Common', 'Orc'],
    traits: ['Menacing', 'Relentless Endurance', 'Savage Attacks']
  },
  
  tiefling: {
    abilityScoreIncrease: { 'Carisma': 2, 'Inteligência': 1 },
    size: 'Medium',
    speed: 30,
    darkvision: 60,
    languages: ['Common', 'Infernal'],
    traits: ['Hellish Resistance', 'Infernal Legacy']
  }
};

// Função para traduzir texto
export function translate(key, category = 'terms') {
  if (!translations[category]) return key;
  return translations[category][key] || key;
}

// Função para traduzir nome de raça
export function translateRace(raceSlug) {
  return translations.races[raceSlug] || raceSlug;
}

// Função para traduzir nome de classe
export function translateClass(classSlug) {
  return translations.classes[classSlug] || classSlug;
}

// Função para traduzir habilidades
export function translateAbility(abilityName) {
  return translations.abilities[abilityName] || abilityName;
}

// Função para traduzir perícias
export function translateSkill(skillName) {
  return translations.skills[skillName] || skillName;
}

// Função para traduzir escola de magia
export function translateSpellSchool(school) {
  return translations.spellSchools[school] || school;
}

// Função para traduzir antecedente
export function translateBackground(background) {
  return translations.backgrounds[background] || background;
}

// Função para traduzir alinhamento
export function translateAlignment(alignment) {
  return translations.alignments[alignment] || alignment;
}

// Função para limpar e formatar descrições HTML
export function cleanDescription(htmlString) {
  if (!htmlString) return '';
  
  return htmlString
    .replace(/<[^>]*>/g, ' ')
    .replace(/\s+/g, ' ')
    .trim();
}

// Função para traduzir termos comuns em descrições
export function translateDescription(description) {
  if (!description) return '';
  
  let translated = description;
  
  Object.entries(translations.terms).forEach(([english, portuguese]) => {
    const regex = new RegExp(english, 'gi');
    translated = translated.replace(regex, portuguese);
  });
  
  return translated;
}

// Função para obter progressão de classe
export function getClassProgression(classSlug, level) {
  const classData = classProgression[classSlug];
  if (!classData) return null;
  
  return {
    hitDie: classData.hitDie,
    primaryAbility: classData.primaryAbility,
    savingThrows: classData.savingThrows,
    spellcaster: classData.spellcaster,
    spellcastingAbility: classData.spellcastingAbility,
    spellSlots: classData.spellSlots ? Object.keys(classData.spellSlots).reduce((slots, spellLevel) => {
      slots[`level${spellLevel}`] = classData.spellSlots[spellLevel][level - 1] || 0;
      return slots;
    }, {}) : {},
    features: Object.keys(classData.features)
      .filter(featureLevel => parseInt(featureLevel) <= level)
      .reduce((features, featureLevel) => {
        features.push(...classData.features[featureLevel].map(feature => ({
          level: parseInt(featureLevel),
          name: feature
        })));
        return features;
      }, [])
  };
}

// Função para obter bônus raciais
export function getRacialBonuses(raceSlug) {
  return racialBonuses[raceSlug] || null;
}

// Função para calcular modificador de habilidade
export function getAbilityModifier(score) {
  return Math.floor((score - 10) / 2);
}

// Função para calcular bônus de proficiência
export function getProficiencyBonus(level) {
  return Math.ceil(level / 4) + 1;
}

// Função para calcular CA baseada em armadura
export function calculateArmorClass(character) {
  const dexMod = getAbilityModifier(character.abilities.Destreza);
  
  // AC base (sem armadura) = 10 + mod Destreza
  let ac = 10 + dexMod;
  
  // Aqui você adicionaria lógica para diferentes tipos de armadura
  // Por exemplo, armadura de couro = 11 + mod Dex
  // Cota de malha = 16 (máx Dex +2), etc.
  
  return ac;
}

// Função para calcular iniciativa
export function calculateInitiative(character) {
  return getAbilityModifier(character.abilities.Destreza);
}

// Função para calcular pontos de vida máximos
export function calculateMaxHitPoints(character) {
  if (!character.class) return 8;
  
  const classData = getClassProgression(character.class.slug, character.level);
  const constMod = getAbilityModifier(character.abilities.Constituição);
  
  // HP no 1º nível = máximo do dado de vida + mod Constituição
  const firstLevelHP = classData.hitDie + constMod;
  
  // HP dos níveis subsequentes = média do dado de vida + mod Constituição
  const additionalHP = (character.level - 1) * (Math.floor(classData.hitDie / 2) + 1 + constMod);
  
  return Math.max(firstLevelHP + additionalHP, character.level);
}

// Função para verificar se uma classe é conjuradora
export function isSpellcaster(classSlug) {
  const classData = classProgression[classSlug];
  return classData ? classData.spellcaster : false;
}

// Função para obter magias disponíveis para uma classe
export function getAvailableSpells(classSlug, spellLevel = 0) {
  // Esta função seria implementada com base na API de magias
  // Por ora, retorna um array vazio
  return [];
}

// Função para aplicar bônus raciais aos atributos
export function applyRacialBonuses(abilities, raceSlug) {
  const bonuses = getRacialBonuses(raceSlug);
  if (!bonuses || !bonuses.abilityScoreIncrease) return abilities;
  
  const modifiedAbilities = { ...abilities };
  
  Object.entries(bonuses.abilityScoreIncrease).forEach(([ability, bonus]) => {
    if (ability === 'all') {
      Object.keys(modifiedAbilities).forEach(abilityName => {
        modifiedAbilities[abilityName] += bonus;
      });
    } else if (ability !== 'choice' && modifiedAbilities[ability] !== undefined) {
      modifiedAbilities[ability] += bonus;
    }
  });
  
  return modifiedAbilities;
}

export default {
  translations,
  classProgression,
  racialBonuses,
  translate,
  translateRace,
  translateClass,
  translateAbility,
  translateSkill,
  translateSpellSchool,
  translateBackground,
  translateAlignment,
  cleanDescription,
  translateDescription,
  getClassProgression,
  getRacialBonuses,
  getAbilityModifier,
  getProficiencyBonus,
  calculateArmorClass,
  calculateInitiative,
  calculateMaxHitPoints,
  isSpellcaster,
  getAvailableSpells,
  applyRacialBonuses
};